@page "/patients"
@inject FhirService FhirService

<h3>Patient Dashboard</h3>

<input @bind="familyName" placeholder="Family name" />
<button @onclick="SearchPatient">Search</button>

@if (patient != null)
{
    <p>Name: @patient.Name[0].Given[0] @patient.Name[0].Family</p>
    <p>Birth Date: @patient.BirthDate</p>

    <h4>Last Vitals</h4>
    <ul>
        @foreach (var obs in vitals)
        {
            <li>@obs.Code.Text: @obs.Value</li>
        }
    </ul>
}

@code {
    private string familyName = "";
    private Patient? patient;
    private List<Observation> vitals = new();

    private async Task SearchPatient()
    {
        patient = await FhirService.GetPatientByFamilyName(familyName);
        if (patient != null)
        {
            vitals = await FhirService.GetLatestVitals(patient.Id);
        }
    }
}
